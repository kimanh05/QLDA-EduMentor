<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>EduMentor ‚Äì Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary: #0059b3;
      --primary-dark: #003b80;
      --accent: #ffc857;
      --bg: #f5f7fb;
      --text: #123047;
      --muted: #7a8aa8;
      --card: #ffffff;
      --danger: #ff4d4f;
      --success: #22a06b;
      --border: #dde3f0;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    button {
      border: none;
      cursor: pointer;
      font: inherit;
    }

    .hidden {
      display: none !important;
    }

    /* ===== HEADER ===== */

    header {
      position: sticky;
      top: 0;
      z-index: 20;
      background: #ffffffcc;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid #e1e6f2;
    }

    .top-bar {
      font-size: 12px;
      color: var(--muted);
      padding: 4px 32px;
      text-align: right;
    }

    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 32px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 800;
      font-size: 22px;
      color: var(--primary-dark);
    }

    .logo-icon {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff 0, #fff 25%, #0da6ff 55%, #003b80 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-size: 18px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    nav {
      display: flex;
      gap: 18px;
      align-items: center;
      font-size: 14px;
    }

    nav button {
      background: none;
      padding: 6px 12px;
      border-radius: 999px;
      color: var(--muted);
      transition: 0.2s;
    }

    nav button.active,
    nav button:hover {
      color: var(--primary-dark);
      background: #e7f1ff;
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 14px;
    }

    .btn {
      padding: 7px 16px;
      border-radius: 999px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: 0.18s all;
      border: 1px solid transparent;
      background: #eef2fb;
      color: var(--primary-dark);
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0, 89, 179, 0.35);
    }

    .btn-outline {
      background: #ffffff;
      border-color: var(--primary);
      color: var(--primary-dark);
    }

    .btn-outline:hover {
      background: #e7f1ff;
    }

    .btn-small {
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 999px;
    }

    .user-pill {
      padding: 6px 12px;
      border-radius: 999px;
      background: #f0f4ff;
      font-size: 13px;
      color: var(--primary-dark);
      max-width: 260px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ===== LAYOUT ===== */

    main {
      padding: 24px 32px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .hero {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 32px;
      align-items: center;
      margin-top: 20px;
    }

    .hero-text h1 {
      font-size: clamp(28px, 4vw, 36px);
      margin-bottom: 12px;
      color: var(--primary-dark);
    }

    .hero-text p {
      font-size: 14px;
      color: var(--muted);
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 8px;
    }

    .hero-badge {
      margin-top: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 14px;
      border-radius: 999px;
      background: #fff7dd;
      font-size: 12px;
      color: #a46a00;
    }

    .hero-card {
      background: var(--card);
      border-radius: 30px;
      box-shadow: 0 14px 30px rgba(15, 40, 90, 0.15);
      overflow: hidden;
      position: relative;
    }

    .hero-card img {
      width: 100%;
      height: 280px;
      object-fit: cover;
      display: block;
    }

    .hero-pill-bottom {
      position: absolute;
      left: 18px;
      bottom: 18px;
      padding: 7px 12px;
      background: rgba(0, 59, 128, 0.9);
      color: white;
      border-radius: 999px;
      font-size: 12px;
      display: inline-flex;
      gap: 10px;
      align-items: center;
    }

    .chip {
      padding: 5px 9px;
      border-radius: 999px;
      font-size: 12px;
      background: #e8f1ff;
      color: var(--primary-dark);
    }

    h2.section-title {
      margin-top: 40px;
      margin-bottom: 18px;
      text-align: center;
      color: var(--primary-dark);
      font-size: 22px;
    }

    .three-columns {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      margin-bottom: 10px;
    }

    .info-card {
      background: var(--card);
      border-radius: 18px;
      padding: 18px 18px 16px;
      box-shadow: 0 6px 16px rgba(9, 30, 66, 0.08);
    }

    .info-icon {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: #e7f1ff;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      font-size: 18px;
    }

    .info-card h3 {
      font-size: 15px;
      margin-bottom: 4px;
      color: var(--primary-dark);
    }

    .info-card p {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.6;
    }

    .section-subtitle {
      text-align: center;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 18px;
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .section-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      text-align: center;
      margin-top: 28px;
      margin-bottom: 6px;
    }

    /* ===== CLASSES & PROFILE ===== */

    .page-section {
      margin-top: 32px;
    }

    .page-title {
      font-size: 20px;
      margin-bottom: 12px;
      color: var(--primary-dark);
      text-align: center;
    }

    .section-lead {
      text-align: center;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 18px;
    }

    .class-list {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .class-card {
      background: var(--card);
      border-radius: 16px;
      padding: 14px 18px;
      box-shadow: 0 5px 14px rgba(15, 40, 90, 0.08);
    }

    .class-top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .class-title {
      font-weight: 600;
      font-size: 15px;
    }

    .badge-subject {
      font-size: 12px;
      padding: 4px 9px;
      border-radius: 999px;
      background: #e7f1ff;
      color: var(--primary-dark);
    }

    .class-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 4px 12px;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
      margin-top: 4px;
    }

    .class-meta span::before {
      content: "‚Ä¢ ";
      color: #c1c7d8;
    }

    .class-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .status-pill {
      padding: 5px 10px;
      border-radius: 999px;
      font-size: 12px;
      background: #f1f3fb;
      color: var(--muted);
    }

    .status-pending {
      background: #fff7dd;
      color: #a46a00;
    }

    .status-accepted {
      background: #e7f9f1;
      color: #107c41;
    }

    .status-rejected {
      background: #ffe6e6;
      color: #b3261e;
    }

    .status-connected {
      background: #dff5ff;
      color: #0059b3;
    }

    .muted {
      color: var(--muted);
      font-size: 12px;
    }

    .avatar-circle {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: #0f7bdd;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      margin-right: 8px;
      flex-shrink: 0;
    }

    .applicant-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #edf0fa;
      gap: 10px;
    }

    .applicant-row:last-child {
      border-bottom: none;
    }

    .applicant-main {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 0;
    }

    .applicant-main div {
      font-size: 13px;
    }

    .rating-stars {
      color: #f5a623;
      font-size: 13px;
    }

    /* ===== PROFILE ===== */

    .profile-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
      gap: 18px;
      align-items: flex-start;
    }

    .profile-card {
      background: var(--card);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 6px 16px rgba(9, 30, 66, 0.08);
    }

    .profile-header {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 10px;
    }

    .profile-avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: #e7f1ff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: var(--primary-dark);
    }

    .profile-header h3 {
      font-size: 18px;
      margin-bottom: 2px;
    }

    .profile-header p {
      font-size: 13px;
      color: var(--muted);
    }

    .profile-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 8px 18px;
      margin-top: 10px;
      font-size: 13px;
    }

    .profile-grid span {
      color: var(--muted);
    }

    .achievements {
      margin-top: 14px;
    }

    .achievements h4 {
      font-size: 14px;
      margin-bottom: 6px;
      color: var(--primary-dark);
    }

    .achievements ul {
      padding-left: 18px;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .achievements textarea {
      width: 100%;
      min-height: 60px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 13px;
      resize: vertical;
      margin-bottom: 6px;
    }

    .small {
      font-size: 11px;
    }

    /* ===== FORMS & MODALS ===== */

    input,
    select {
      width: 100%;
      padding: 8px 10px;
      font-size: 13px;
      border-radius: 999px;
      border: 1px solid var(--border);
      outline: none;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px #cfe3ff;
    }

    label {
      font-size: 13px;
      margin-bottom: 4px;
      display: block;
      color: var(--text);
    }

    .form-row {
      margin-bottom: 10px;
    }

    .two-cols {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(10, 20, 40, 0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: 0.18s ease;
      z-index: 50;
    }

    .modal-backdrop.show {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: white;
      border-radius: 18px;
      padding: 18px 20px 16px;
      width: min(420px, 92vw);
      box-shadow: 0 18px 40px rgba(5, 18, 40, 0.35);
      position: relative;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary-dark);
    }

    .modal-close {
      background: none;
      font-size: 18px;
      padding: 2px 4px;
      color: var(--muted);
    }

    .modal-tabs {
      display: flex;
      gap: 4px;
      margin: 10px 0 14px;
      background: #f3f5fb;
      padding: 3px;
      border-radius: 999px;
      font-size: 13px;
    }

    .modal-tab {
      flex: 1;
      text-align: center;
      padding: 6px 0;
      border-radius: 999px;
      cursor: pointer;
      color: var(--muted);
    }

    .modal-tab.active {
      background: white;
      color: var(--primary-dark);
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(9, 30, 66, 0.16);
    }

    .modal-footer {
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      text-align: center;
    }

    .link {
      color: var(--primary);
      cursor: pointer;
      font-weight: 600;
    }

    .qr-box {
      margin: 10px 0;
      border-radius: 12px;
      padding: 14px;
      background: #f3f5fb;
      text-align: center;
      font-size: 13px;
    }

    .qr-placeholder {
      margin: 0 auto 8px;
      width: 150px;
      height: 150px;
      background-image: repeating-linear-gradient(
          45deg,
          #0b4ea2 0,
          #0b4ea2 5px,
          #ffffff 5px,
          #ffffff 10px
        ),
        repeating-linear-gradient(
          -45deg,
          #0b4ea2 0,
          #0b4ea2 5px,
          #ffffff 5px,
          #ffffff 10px
        );
      background-blend-mode: multiply;
      border-radius: 12px;
    }

    .qr-text {
      margin-bottom: 4px;
    }

    /* QUIZ */

    .quiz-list {
      margin-top: 10px;
      font-size: 13px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .quiz-question {
      margin-bottom: 10px;
    }

    .quiz-question strong {
      display: block;
      margin-bottom: 4px;
    }

    .quiz-options label {
      display: block;
      margin-bottom: 2px;
      cursor: pointer;
    }

    .badge {
      display: inline-block;
      padding: 3px 7px;
      border-radius: 999px;
      font-size: 11px;
      background: #e7f1ff;
      color: var(--primary-dark);
    }

    /* FOOTER */

    footer {
      border-top: 1px solid #e1e6f2;
      padding: 18px 32px 10px;
      margin-top: 32px;
      background: #ffffff;
      font-size: 12px;
      color: var(--muted);
    }

    .footer-grid {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 14px;
    }

    .footer-title {
      font-weight: 700;
      color: var(--primary-dark);
      margin-bottom: 6px;
      font-size: 13px;
    }

    .footer-bottom {
      max-width: 1200px;
      margin: 10px auto 0;
      text-align: center;
      font-size: 11px;
    }

    @media (max-width: 800px) {
      header {
        position: static;
      }
      main {
        padding: 18px 16px 30px;
      }
      .navbar {
        flex-wrap: wrap;
        gap: 10px;
      }
      nav {
        order: 3;
        width: 100%;
        justify-content: center;
        flex-wrap: wrap;
      }
      .hero {
        grid-template-columns: 1fr;
      }
      .profile-layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="top-bar">
      Trang web l√† s·∫£n ph·∫©m c·ªßa m√¥n h·ªçc <strong>Qu·∫£n l√≠ d·ª± √°n cho kƒ© s∆∞ ‚Äì HK251</strong>.
    </div>
    <div class="navbar">
      <div class="logo">
        <div class="logo-icon">üéì</div>
        <div>EduMentor</div>
      </div>

      <nav>
        <button class="nav-link active" data-section="home-section">Trang ch·ªß</button>
        <button class="nav-link" data-section="classes-section">Danh s√°ch l·ªõp</button>
        <button class="nav-link" data-section="tutor-section">Gia s∆∞</button>
        <button class="nav-link" data-section="parent-posts-section">B√†i ƒëƒÉng c·ªßa t√¥i</button>
        <button class="nav-link" data-section="create-post-section">ƒêƒÉng b√†i t√¨m gia s∆∞</button>
      </nav>

      <div class="nav-right">
        <div id="auth-logged-out">
          <button class="btn btn-outline" id="open-register">üìù ƒêƒÉng k√≠</button>
          <button class="btn btn-primary" id="open-login">üîê ƒêƒÉng nh·∫≠p</button>
        </div>
        <div id="auth-logged-in" class="hidden">
          <span id="current-user-label" class="user-pill"></span>
          <button class="btn btn-outline btn-small" id="logout-btn">ƒêƒÉng xu·∫•t</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <!-- ===== HOME ===== -->
    <section class="hero page-section" id="home-section">
      <div class="hero-text">
        <h1>Gia s∆∞ t·∫≠n t√¢m ‚Äì Ti·∫øn xa v·∫°n d·∫∑m</h1>
        <p>
          EduMentor l√† n·ªÅn t·∫£ng k·∫øt n·ªëi gia s∆∞ v√† h·ªçc vi√™n uy t√≠n, v·ªõi ƒë·ªôi ng≈© gia s∆∞ ch·∫•t l∆∞·ª£ng cao,
          ph∆∞∆°ng ph√°p gi·∫£ng d·∫°y hi·ªán ƒë·∫°i v√† h·ªá th·ªëng qu·∫£n l√Ω h·ªçc t·∫≠p th√¥ng minh. Ch√∫ng t√¥i cam k·∫øt mang l·∫°i
          tr·∫£i nghi·ªám h·ªçc t·∫≠p t·ªët nh·∫•t cho h·ªçc vi√™n.
        </p>
        <p>
          Ch·ªâ v·ªõi v√†i b∆∞·ªõc ƒë∆°n gi·∫£n, b·∫°n c√≥ th·ªÉ t√¨m ƒë∆∞·ª£c gia s∆∞ ph√π h·ª£p ho·∫∑c nh·∫≠n l·ªõp d·∫°y th√™m ƒë√∫ng chuy√™n m√¥n.
        </p>

        <div class="hero-actions">
          <button class="btn btn-primary" id="cta-find-class">üîç T√¨m l·ªõp ngay</button>
          <button class="btn btn-outline" id="cta-become-tutor">‚ú® Tr·ªü th√†nh gia s∆∞</button>
        </div>

        <div class="hero-badge">
          <span>ü§ù H·ªó tr·ª£ k·∫øt n·ªëi minh b·∫°ch</span>
          <span>üí∏ Ph√≠ nh·∫≠n l·ªõp r√µ r√†ng cho gia s∆∞ (25% th√°ng ƒë·∫ßu)</span>
        </div>
      </div>

      <div class="hero-card">
        <img
          src="https://images.pexels.com/photos/4144222/pexels-photo-4144222.jpeg?auto=compress&cs=tinysrgb&w=1200"
          alt="H·ªçc sinh h·ªçc c√πng gia s∆∞"
        />
        <div class="hero-pill-bottom">
          <span>Gia s∆∞ t·∫≠n t√¢m</span>
          <span class="chip">H·ªçc sinh ti·∫øn b·ªô</span>
        </div>
      </div>
    </section>

    <div>
      <h2 class="section-title">T·∫°i sao ch·ªçn EduMentor?</h2>
      <div class="section-subtitle">
        K·∫øt n·ªëi h·ªçc vi√™n ‚Äì gia s∆∞ m·ªôt c√°ch <strong>nhanh ch√≥ng, minh b·∫°ch</strong> v√† <strong>an to√†n</strong>.
      </div>
      <div class="three-columns">
        <div class="info-card">
          <div class="info-icon">üéØ</div>
          <h3>Gia s∆∞ ch·∫•t l∆∞·ª£ng</h3>
          <p>ƒê·ªôi ng≈© gia s∆∞ ƒë∆∞·ª£c tuy·ªÉn ch·ªçn k·ªπ l∆∞·ª°ng, c√≥ tr√¨nh ƒë·ªô chuy√™n m√¥n cao v√† kinh nghi·ªám gi·∫£ng d·∫°y phong ph√∫.</p>
        </div>
        <div class="info-card">
          <div class="info-icon">‚è∞</div>
          <h3>Linh ho·∫°t th·ªùi gian</h3>
          <p>H·ªçc m·ªçi l√∫c, m·ªçi n∆°i v·ªõi l·ªãch h·ªçc linh ho·∫°t ƒë∆∞·ª£c s·∫Øp x·∫øp theo nhu c·∫ßu c·ªßa h·ªçc vi√™n.</p>
        </div>
        <div class="info-card">
          <div class="info-icon">üìà</div>
          <h3>Hi·ªáu qu·∫£ cao</h3>
          <p>Ph∆∞∆°ng ph√°p gi·∫£ng d·∫°y c√° nh√¢n h√≥a gi√∫p h·ªçc vi√™n ti·∫øp thu ki·∫øn th·ª©c nhanh ch√≥ng v√† hi·ªáu qu·∫£.</p>
        </div>
      </div>

      <div class="section-label">C√°ch th·ª©c ho·∫°t ƒë·ªông</div>
      <div class="three-columns">
        <div class="info-card">
          <div class="info-icon">üë§</div>
          <h3>ƒêƒÉng k√Ω t√†i kho·∫£n</h3>
          <p>T·∫°o t√†i kho·∫£n h·ªçc vi√™n, ph·ª• huynh ho·∫∑c gia s∆∞ trong v√†i b∆∞·ªõc ƒë∆°n gi·∫£n.</p>
        </div>
        <div class="info-card">
          <div class="info-icon">üîé</div>
          <h3>T√¨m ki·∫øm ph√π h·ª£p</h3>
          <p>T√¨m gia s∆∞ ho·∫∑c l·ªõp h·ªçc ph√π h·ª£p v·ªõi nhu c·∫ßu, m√¥n h·ªçc v√† m·ª©c h·ªçc ph√≠ mong mu·ªën.</p>
        </div>
        <div class="info-card">
          <div class="info-icon">üîó</div>
          <h3>K·∫øt n·ªëi ‚Äì Thanh to√°n</h3>
          <p>
            Gia s∆∞ thanh to√°n ph√≠ nh·∫≠n l·ªõp (25% l∆∞∆°ng th√°ng ƒë·∫ßu), k·∫øt n·ªëi l·ªõp th√†nh c√¥ng v√† b·∫Øt ƒë·∫ßu bu·ªïi h·ªçc ƒë·∫ßu ti√™n.
          </p>
        </div>
      </div>
    </div>

    <!-- ===== CLASSES FOR TUTOR ===== -->
    <section class="page-section hidden" id="classes-section">
      <h2 class="page-title">Danh s√°ch b√†i ƒëƒÉng c·∫ßn gia s∆∞</h2>
      <p class="section-lead">
        ƒêƒÉng nh·∫≠p v·ªõi vai tr√≤ <strong>Gia s∆∞</strong> ƒë·ªÉ ƒëƒÉng k√Ω nh·∫≠n l·ªõp, thanh to√°n ph√≠ nh·∫≠n l·ªõp v√† xem tr·∫°ng th√°i.
      </p>
      <div id="classes-list" class="class-list"></div>
    </section>

    <!-- ===== TUTOR PROFILE ===== -->
    <section class="page-section hidden" id="tutor-section">
      <h2 class="page-title">Th√¥ng tin gia s∆∞</h2>
      <p class="section-lead">
        Xem h·ªì s∆°, th√†nh t√≠ch c·ªßa gia s∆∞ v√† c√°c l·ªõp ƒë√£ ƒëƒÉng k√≠. Ph·ª• huynh c√≥ th·ªÉ s·ª≠ d·ª•ng ph·∫ßn n√†y ƒë·ªÉ ƒë√°nh gi√° kh√°ch quan.
      </p>
      <div id="tutor-not-logged" class="section-lead">
        Vui l√≤ng ƒëƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n <strong>Gia s∆∞</strong> ƒë·ªÉ xem h·ªì s∆° v√† l·ªãch s·ª≠ nh·∫≠n l·ªõp.
      </div>
      <div id="tutor-profile-wrapper" class="profile-layout hidden">
        <div class="profile-card" id="tutor-profile-card"></div>
        <div class="profile-card">
          <h3 style="font-size:16px;margin-bottom:8px;color:var(--primary-dark);">
            C√°c l·ªõp gia s∆∞ ƒë√£ ƒëƒÉng k√≠
          </h3>
          <div id="tutor-classes-list" class="class-list"></div>
        </div>
      </div>
    </section>

    <!-- ===== PARENT POSTS ===== -->
    <section class="page-section hidden" id="parent-posts-section">
      <h2 class="page-title">C√°c b√†i ƒëƒÉng c·ªßa ph·ª• huynh ‚Äì h·ªçc sinh</h2>
      <p class="section-lead">
        ƒêƒÉng nh·∫≠p t√†i kho·∫£n <strong>ph·ª• huynh</strong> ƒë·ªÉ xem danh s√°ch b√†i ƒëƒÉng, xem gia s∆∞ ·ª©ng tuy·ªÉn v√† ch·∫•p nh·∫≠n / t·ª´ ch·ªëi.
      </p>
      <div id="parent-not-logged" class="section-lead">
        Hi·ªán b·∫°n ch∆∞a ƒëƒÉng nh·∫≠p v·ªõi vai tr√≤ <strong>Ph·ª• huynh ‚Äì H·ªçc sinh</strong>.
      </div>
      <div id="parent-posts-wrapper" class="hidden">
        <div id="parent-posts-list" class="class-list"></div>
      </div>
    </section>

    <!-- ===== CREATE POST ===== -->
    <section class="page-section hidden" id="create-post-section">
      <h2 class="page-title">ƒêƒÉng b√†i t√¨m gia s∆∞</h2>
      <p class="section-lead">
        Ph·ª• huynh / h·ªçc sinh c√≥ th·ªÉ ƒëƒÉng b√†i t√¨m gia s∆∞ v·ªõi m√¥n h·ªçc, m·ª©c l∆∞∆°ng v√† y√™u c·∫ßu c·ª• th·ªÉ.
      </p>
      <div id="create-post-guard" class="section-lead">
        Vui l√≤ng ƒëƒÉng nh·∫≠p v·ªõi vai tr√≤ <strong>Ph·ª• huynh ‚Äì H·ªçc sinh</strong> ƒë·ªÉ ƒëƒÉng b√†i.
      </div>
      <div id="create-post-form-wrapper" class="profile-card hidden" style="max-width:640px;margin:0 auto;">
        <div class="form-row two-cols">
          <div>
            <label>M√¥n h·ªçc gia s∆∞ *</label>
            <select id="post-subject">
              <option value="To√°n">To√°n</option>
              <option value="V·∫≠t l√Ω">V·∫≠t l√Ω</option>
              <option value="H√≥a h·ªçc">H√≥a h·ªçc</option>
              <option value="Ti·∫øng Anh">Ti·∫øng Anh</option>
            </select>
          </div>
          <div>
            <label>Th√¥ng tin h·ªçc sinh *</label>
            <input id="post-grade" placeholder="VD: H·ªçc sinh l·ªõp 8" />
          </div>
        </div>
        <div class="form-row">
          <label>ƒê·ªãa ch·ªâ h·ªçc *</label>
          <input id="post-address" placeholder="VD: 123 ƒë∆∞·ªùng ƒê·∫∑ng Th·ªã Nhu" />
        </div>
        <div class="form-row two-cols">
          <div>
            <label>Th·ªùi gian h·ªçc *</label>
            <input id="post-schedule" placeholder="VD: Th·ª© hai 2PM - 4PM" />
          </div>
          <div>
            <label>M·ª©c l∆∞∆°ng ƒë·ªÅ xu·∫•t *</label>
            <input id="post-fee" placeholder="VD: 300.000 VND/bu·ªïi" />
          </div>
        </div>
        <div class="form-row two-cols">
          <div>
            <label>Y√™u c·∫ßu b·∫±ng c·∫•p</label>
            <input id="post-degree" placeholder="VD: T·ªët nghi·ªáp ƒêH S∆∞ ph·∫°m" />
          </div>
          <div>
            <label>Y√™u c·∫ßu gi·ªõi t√≠nh / kinh nghi·ªám</label>
            <input id="post-gender" placeholder="Kh√¥ng y√™u c·∫ßu / Nam / N·ªØ / 2 nƒÉm kinh nghi·ªám..." />
          </div>
        </div>
        <div class="form-row">
          <label>M·ª•c ti√™u h·ªçc t·∫≠p</label>
          <input id="post-goal" placeholder="VD: C·∫£i thi·ªán ƒëi·ªÉm, luy·ªán thi..." />
        </div>
        <div class="form-row">
          <label>S·ªë ƒëi·ªán tho·∫°i li√™n h·ªá *</label>
          <input id="post-phone" placeholder="VD: 0123 456 789" />
        </div>
        <div style="text-align:right;margin-top:8px;">
          <button class="btn btn-primary" id="submit-post-btn">‚û§ ƒêƒÉng b√†i ngay</button>
        </div>
        <p class="small muted" style="margin-top:6px;">
          *B√†i ƒëƒÉng ch·ªâ l√† d·ªØ li·ªáu minh ho·∫°, kh√¥ng ƒë∆∞·ª£c d√πng cho m·ª•c ƒë√≠ch th∆∞∆°ng m·∫°i.
        </p>
      </div>
    </section>
  </main>

  <!-- ===== LOGIN MODAL ===== -->
  <div class="modal-backdrop" id="login-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">ƒêƒÉng nh·∫≠p</div>
        <button class="modal-close" data-close="login-modal">‚úï</button>
      </div>
      <div class="modal-tabs">
        <div class="modal-tab active" data-login-target="parent">Ph·ª• huynh ‚Äì H·ªçc sinh</div>
        <div class="modal-tab" data-login-target="tutor">Gia s∆∞</div>
      </div>

      <form id="login-parent-form">
        <div class="form-row">
          <label>T√™n t√†i kho·∫£n *</label>
          <input id="login-parent-username" placeholder="VD: phuhuynh" />
        </div>
        <div class="form-row">
          <label>M·∫≠t kh·∫©u *</label>
          <input id="login-parent-password" type="password" />
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;margin-top:6px;">
          üîì ƒêƒÉng nh·∫≠p
        </button>
      </form>

      <form id="login-tutor-form" class="hidden">
        <div class="form-row">
          <label>T√™n t√†i kho·∫£n *</label>
          <input id="login-tutor-username" placeholder="VD: kimanh" />
        </div>
        <div class="form-row">
          <label>M·∫≠t kh·∫©u *</label>
          <input id="login-tutor-password" type="password" />
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;margin-top:6px;">
          üîì ƒêƒÉng nh·∫≠p
        </button>
      </form>

      <div class="modal-footer">
        Ch∆∞a c√≥ t√†i kho·∫£n? <span class="link" id="login-open-register">ƒêƒÉng k√Ω ngay</span>
      </div>
    </div>
  </div>

  <!-- ===== REGISTER MODAL ===== -->
  <div class="modal-backdrop" id="register-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">ƒêƒÉng k√Ω t√†i kho·∫£n</div>
        <button class="modal-close" data-close="register-modal">‚úï</button>
      </div>
      <form id="register-form">
        <div class="form-row two-cols">
          <div>
            <label>H·ªç *</label>
            <input id="reg-lastname" />
          </div>
          <div>
            <label>T√™n *</label>
            <input id="reg-firstname" />
          </div>
        </div>
        <div class="form-row">
          <label>Email *</label>
          <input id="reg-email" />
        </div>
        <div class="form-row">
          <label>S·ªë ƒëi·ªán tho·∫°i *</label>
          <input id="reg-phone" />
        </div>
        <div class="form-row">
          <label>T√™n t√†i kho·∫£n *</label>
          <input id="reg-username" placeholder="Kh√¥ng d·∫•u, kh√¥ng kho·∫£ng tr·∫Øng" />
        </div>
        <div class="form-row">
          <label>M·∫≠t kh·∫©u *</label>
          <input id="reg-password" type="password" />
        </div>
        <div class="form-row">
          <label>B·∫°n l√† *</label>
          <select id="reg-role">
            <option value="tutor">Gia s∆∞</option>
            <option value="parent">Ph·ª• huynh ‚Äì H·ªçc sinh</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;margin-top:6px;">
          ‚ûï ƒêƒÉng k√Ω
        </button>
        <div class="modal-footer">
          ƒê√£ c√≥ t√†i kho·∫£n? <span class="link" id="register-open-login">ƒêƒÉng nh·∫≠p ngay</span>
        </div>
      </form>
      <p class="small muted" style="margin-top:4px;">
        V·ªõi t√†i kho·∫£n <strong>Gia s∆∞</strong>, b·∫°n c·∫ßn <strong>l√†m b√†i ki·ªÉm tra 8/10</strong> ƒë·ªÉ ƒë∆∞·ª£c k√≠ch ho·∫°t v√† nh·∫≠n l·ªõp.
      </p>
    </div>
  </div>

  <!-- ===== QUIZ MODAL ===== -->
  <div class="modal-backdrop" id="quiz-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">B√†i ki·ªÉm tra d√†nh cho gia s∆∞</div>
        <button class="modal-close" data-close="quiz-modal">‚úï</button>
      </div>
      <p class="small muted">
        Ch·ªçn m√¥n b·∫°n mu·ªën d·∫°y v√† tr·∫£ l·ªùi 5 c√¢u h·ªèi tr·∫Øc nghi·ªám. M·ªói c√¢u 2 ƒëi·ªÉm, ƒë·∫°t
        <strong>t·ª´ 8/10</strong> tr·ªü l√™n th√¨ t√†i kho·∫£n gia s∆∞ s·∫Ω ƒë∆∞·ª£c k√≠ch ho·∫°t.
      </p>
      <div class="form-row" style="margin-top:8px;">
        <label>M√¥n ki·ªÉm tra</label>
        <select id="quiz-subject">
          <option value="To√°n">To√°n</option>
          <option value="V·∫≠t l√Ω">V·∫≠t l√Ω</option>
          <option value="Ti·∫øng Anh">Ti·∫øng Anh</option>
        </select>
      </div>
      <div class="quiz-list" id="quiz-list"></div>
      <button class="btn btn-primary" style="width:100%;margin-top:8px;" id="quiz-submit-btn">
        ‚úÖ N·ªôp b√†i ki·ªÉm tra
      </button>
      <div class="modal-footer" id="quiz-result" style="min-height:18px;"></div>
    </div>
  </div>

  <!-- ===== PAYMENT MODAL ===== -->
  <div class="modal-backdrop" id="payment-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Thanh to√°n ph√≠ nh·∫≠n l·ªõp</div>
        <button class="modal-close" data-close="payment-modal">‚úï</button>
      </div>
      <p class="small muted">
        Gia s∆∞ thanh to√°n <strong>25% ti·ªÅn l∆∞∆°ng th√°ng ƒë·∫ßu ti√™n</strong> ƒë·ªÉ x√°c nh·∫≠n nh·∫≠n l·ªõp. ƒê√¢y ch·ªâ l√†
        minh ho·∫°, kh√¥ng ph√°t sinh giao d·ªãch th·∫≠t.
      </p>
      <div class="qr-box">
        <div class="qr-placeholder"></div>
        <div class="qr-text"><strong>M√É QR M·∫™U ‚Äì CHUY·ªÇN KHO·∫¢N</strong></div>
        <div>STK: <strong>123456789</strong></div>
        <div>Ch·ªß t√†i kho·∫£n: <strong>EDUMENTOR</strong></div>
        <div>Ng√¢n h√†ng: <strong>VIETCOMBANK</strong></div>
      </div>
      <p class="small muted" id="payment-class-text"></p>
      <button class="btn btn-primary" style="width:100%;margin-top:8px;" id="confirm-payment-btn">
        üí≥ T√¥i ƒë√£ thanh to√°n
      </button>
    </div>
  </div>

  <!-- ===== APPLICANTS MODAL ===== -->
  <div class="modal-backdrop" id="applicants-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Danh s√°ch gia s∆∞ ·ª©ng tuy·ªÉn</div>
        <button class="modal-close" data-close="applicants-modal">‚úï</button>
      </div>
      <div id="applicants-list"></div>
      <div class="modal-footer small">
        Ph·ª• huynh ch·ªâ c·∫ßn <strong>ch·∫•p nh·∫≠n 1 gia s∆∞</strong>, c√°c gia s∆∞ c√≤n l·∫°i s·∫Ω ƒë∆∞·ª£c th√¥ng b√°o ‚Äúƒë√£ c√≥ ng∆∞·ªùi kh√°c‚Äù.
      </div>
    </div>
  </div>

  <footer>
    <div class="footer-grid">
      <div>
        <div class="footer-title">EDU MENTOR</div>
        <p>K·∫øt n·ªëi gia s∆∞ ch·∫•t l∆∞·ª£ng v·ªõi h·ªçc vi√™n tr√™n to√†n qu·ªëc. Cam k·∫øt mang l·∫°i tr·∫£i nghi·ªám h·ªçc t·∫≠p t·ªët nh·∫•t.</p>
      </div>
      <div>
        <div class="footer-title">Li√™n k·∫øt nhanh</div>
        <p>Trang ch·ªß</p>
        <p>Danh s√°ch l·ªõp</p>
        <p>ƒêƒÉng b√†i t√¨m gia s∆∞</p>
      </div>
      <div>
        <div class="footer-title">Li√™n h·ªá</div>
        <p>üìû 0123 456 789</p>
        <p>‚úâ anh.nguyen2510@hcmut.edu.vn</p>
        <p>üìç Tr∆∞·ªùng ƒê·∫°i h·ªçc B√°ch khoa - ƒêHQG TP.HCM</p>
      </div>
    </div>
    <div class="footer-bottom">¬© 2025 EDU MENTOR. All rights reserved.</div>
  </footer>

  <script>
    // ===== DATA MODEL =====
    const users = {
      kimanh: {
        username: "kimanh",
        password: "123456",
        role: "tutor",
        name: "Nguy·ªÖn Kim Anh",
        gender: "N·ªØ",
        phone: "0909 123 456",
        email: "kimanh@example.com",
        degree: "Sinh vi√™n Khoa Khoa h·ªçc v√† Kƒ© thu·∫≠t M√°y t√≠nh ‚Äì HCMUT",
        experience: "2 nƒÉm l√†m gia s∆∞ c√°c m√¥n To√°n ‚Äì L√Ω c·∫•p 2",
        subject: "To√°n",
        achievements: [
          "ƒê·∫°t h·ªçc b·ªïng khuy·∫øn kh√≠ch h·ªçc t·∫≠p nhi·ªÅu k√¨ t·∫°i ƒêH B√°ch khoa.",
          "Kinh nghi·ªám √¥n thi v√†o 10 cho nhi·ªÅu h·ªçc sinh t·∫°i TP.HCM."
        ],
        ratingValue: 4.5,
        ratingCount: 2,
        approved: true
      },
      thaongoc: {
        username: "thaongoc",
        password: "123456",
        role: "tutor",
        name: "Ph·∫°m Th·∫£o Ng·ªçc",
        gender: "N·ªØ",
        phone: "0912 456 789",
        email: "thaongoc@example.com",
        degree: "Sinh vi√™n ch∆∞∆°ng tr√¨nh K·ªπ s∆∞ T√†i nƒÉng ‚Äì HCMUT",
        experience: "Gia s∆∞ To√°n ‚Äì Ti·∫øng Anh 3 nƒÉm",
        subject: "Ti·∫øng Anh",
        achievements: [
          "IELTS 7.5, t·ª´ng tham gia h·ªó tr·ª£ CLB ti·∫øng Anh cho h·ªçc sinh THPT.",
          "C√≥ kinh nghi·ªám d·∫°y online cho h·ªçc sinh ·ªü nhi·ªÅu t·ªânh."
        ],
        ratingValue: 4.8,
        ratingCount: 3,
        approved: true
      },
      phuhuynh: {
        username: "phuhuynh",
        password: "123456",
        role: "parent",
        name: "Tr·ªãnh Ph∆∞∆°ng Tu·∫•n",
        gender: "Nam",
        phone: "0123 456 789",
        email: "tuan.ph@example.com"
      }
    };

    const classes = [
      {
        id: 1,
        parentUsername: "phuhuynh",
        parentName: "ƒê·ªó Th·ªã C",
        subject: "V·∫≠t l√Ω",
        gradeText: "H·ªçc sinh l·ªõp 11",
        address: "123 ƒë∆∞·ªùng ƒê·∫∑ng Th·ªã Nhu",
        schedule: "Th·ª© t∆∞ 2PM - 4PM",
        fee: "3.000.000 VND/th√°ng",
        degreeReq: "T·ªët nghi·ªáp ƒê·∫°i h·ªçc S∆∞ ph·∫°m",
        genderReq: "Kh√¥ng y√™u c·∫ßu",
        goal: "C·∫£i thi·ªán ƒëi·ªÉm",
        phone: "0123456789",
        applicants: [],
        acceptedTutor: null,
        rating: null
      },
      {
        id: 2,
        parentUsername: "phuhuynh",
        parentName: "ƒê·ªó Th·ªã C",
        subject: "To√°n",
        gradeText: "H·ªçc sinh l·ªõp 8",
        address: "XXX ƒë∆∞·ªùng ƒê·∫∑ng Th·ªã Nhu",
        schedule: "Th·ª© hai 7PM - 9PM",
        fee: "2.000.000 VND/th√°ng",
        degreeReq: "Sinh vi√™n nƒÉm 2 tr·ªü l√™n",
        genderReq: "∆Øu ti√™n N·ªØ",
        goal: "C·ªßng c·ªë ki·∫øn th·ª©c n·ªÅn t·∫£ng",
        phone: "0123456XXX",
        applicants: [],
        acceptedTutor: null,
        rating: null
      },
      {
        id: 3,
        parentUsername: "phuhuynh",
        parentName: "ƒê·ªó Th·ªã C",
        subject: "Ti·∫øng Anh",
        gradeText: "H·ªçc sinh l·ªõp 10",
        address: "123 ƒë∆∞·ªùng ƒê·∫∑ng Th·ªã Nhu",
        schedule: "Th·ª© b·∫£y 8AM - 10AM",
        fee: "300 USD/th√°ng",
        degreeReq: "IELTS t·ª´ 7.0",
        genderReq: "Kh√¥ng y√™u c·∫ßu",
        goal: "Luy·ªán giao ti·∫øp & thi IELTS",
        phone: "0123456789",
        applicants: [],
        acceptedTutor: null,
        rating: null
      },
      {
        id: 4,
        parentUsername: "phuhuynh",
        parentName: "ƒê·ªó Th·ªã C",
        subject: "H√≥a h·ªçc",
        gradeText: "H·ªçc sinh l·ªõp 9",
        address: "Qu·∫≠n 10, TP.HCM",
        schedule: "Th·ª© ba 7PM - 9PM",
        fee: "2.500.000 VND/th√°ng",
        degreeReq: "Sinh vi√™n ng√†nh H√≥a",
        genderReq: "Kh√¥ng y√™u c·∫ßu",
        goal: "√în thi v√†o 10",
        phone: "0987654321",
        applicants: [],
        acceptedTutor: null,
        rating: null
      },
      {
        id: 5,
        parentUsername: "phuhuynh",
        parentName: "ƒê·ªó Th·ªã C",
        subject: "To√°n",
        gradeText: "H·ªçc sinh l·ªõp 6",
        address: "Th·ªß ƒê·ª©c, TP.HCM",
        schedule: "Ch·ªß nh·∫≠t 9AM - 11AM",
        fee: "1.800.000 VND/th√°ng",
        degreeReq: "Sinh vi√™n S∆∞ ph·∫°m/ B√°ch khoa",
        genderReq: "Kh√¥ng y√™u c·∫ßu",
        goal: "R√®n luy·ªán t∆∞ duy, t·∫°o h·ª©ng th√∫ h·ªçc",
        phone: "0912345678",
        applicants: [],
        acceptedTutor: null,
        rating: null
      }
    ];

    let currentUser = null;
    let currentQuizUser = null;
    let currentPaymentClassId = null;
    let currentApplicantsClassId = null;

    // ===== HELPERS =====
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    function showSection(id) {
      $$(".page-section").forEach((sec) => {
        if (sec.id === id) sec.classList.remove("hidden");
        else sec.classList.add("hidden");
      });
      $$(".nav-link").forEach((btn) => {
        btn.classList.toggle("active", btn.dataset.section === id);
      });
      if (id === "tutor-section") renderTutorProfile();
      if (id === "classes-section") renderClassesForTutor();
      if (id === "parent-posts-section") renderParentPosts();
    }

    function openModal(id) {
      const el = document.getElementById(id);
      if (el) el.classList.add("show");
    }

    function closeModal(id) {
      const el = document.getElementById(id);
      if (el) el.classList.remove("show");
    }

    function updateAuthUI() {
      if (!currentUser) {
        $("#auth-logged-out").classList.remove("hidden");
        $("#auth-logged-in").classList.add("hidden");
        $("#current-user-label").textContent = "";
      } else {
        $("#auth-logged-out").classList.add("hidden");
        $("#auth-logged-in").classList.remove("hidden");
        const roleLabel = currentUser.role === "tutor" ? "Gia s∆∞" : "PH/HS";
        $("#current-user-label").textContent = `${currentUser.name} (${roleLabel})`;
      }
      renderClassesForTutor();
      renderTutorProfile();
      renderParentPosts();
      updateCreatePostGuard();
    }

    function getApplicationForTutor(cls, username) {
      return cls.applicants.find((a) => a.username === username) || null;
    }

    function renderClassesForTutor() {
      const container = $("#classes-list");
      if (!container) return;
      let html = "";
      classes.forEach((cls) => {
        const isTutor = currentUser && currentUser.role === "tutor";
        let statusHtml = "";
        let actionHtml = "";

        if (!isTutor) {
          statusHtml =
            '<span class="muted">ƒêƒÉng nh·∫≠p v·ªõi vai tr√≤ Gia s∆∞ ƒë·ªÉ ƒëƒÉng k√≠ nh·∫≠n l·ªõp.</span>';
        } else if (!currentUser.approved) {
          statusHtml =
            '<span class="status-pill status-pending">B·∫°n c·∫ßn ho√†n th√†nh b√†i ki·ªÉm tra ƒë·ªÉ ƒë∆∞·ª£c nh·∫≠n l·ªõp.</span>';
          actionHtml =
            '<button class="btn btn-small btn-outline" id="open-quiz-from-status">L√†m b√†i ki·ªÉm tra</button>';
        } else {
          const app = getApplicationForTutor(cls, currentUser.username);
          if (!app) {
            statusHtml = '<span class="status-pill">Ch∆∞a ƒëƒÉng k√≠ l·ªõp n√†y</span>';
            actionHtml = `<button class="btn btn-primary btn-small" data-action="apply" data-id="${cls.id}">ƒêƒÉng k√≠ nh·∫≠n l·ªõp</button>`;
          } else if (app.status === "pending") {
            statusHtml =
              '<span class="status-pill status-pending">ƒêang ch·ªù ph·ª• huynh ch·∫•p nh·∫≠n</span>';
          } else if (app.status === "accepted") {
            statusHtml =
              '<span class="status-pill status-accepted">Ph·ª• huynh ƒë√£ ch·∫•p nh·∫≠n. Vui l√≤ng thanh to√°n ph√≠ nh·∫≠n l·ªõp.</span>';
            actionHtml = `<button class="btn btn-primary btn-small" data-action="pay" data-id="${cls.id}">Thanh to√°n ph√≠ 25%</button>`;
          } else if (app.status === "paid") {
            statusHtml =
              '<span class="status-pill status-connected">K·∫øt n·ªëi l·ªõp th√†nh c√¥ng ‚Äì ch√∫c b·∫°n d·∫°y t·ªët!</span>';
          } else if (app.status === "rejected") {
            statusHtml =
              '<span class="status-pill status-rejected">R·∫•t ti·∫øc, ƒë√£ c√≥ gia s∆∞ kh√°c ƒë∆∞·ª£c ch·ªçn.</span>';
          }
        }

        html += `
        <div class="class-card">
          <div class="class-top-row">
            <div>
              <div class="class-title">${cls.parentName}</div>
              <div class="muted">C·∫ßn gia s∆∞ m√¥n ${cls.subject} ‚Äì ${cls.gradeText}</div>
            </div>
            <div class="badge-subject">${cls.subject}</div>
          </div>
          <div class="class-meta">
            <span>ƒê·ªãa ch·ªâ h·ªçc: ${cls.address}</span>
            <span>Th·ªùi gian: ${cls.schedule}</span>
            <span>M·ª©c l∆∞∆°ng: ${cls.fee}</span>
            <span>Y√™u c·∫ßu b·∫±ng c·∫•p: ${cls.degreeReq}</span>
            <span>Y√™u c·∫ßu gi·ªõi t√≠nh/kinh nghi·ªám: ${cls.genderReq}</span>
            <span>M·ª•c ti√™u h·ªçc t·∫≠p: ${cls.goal}</span>
          </div>
          <div class="class-footer">
            <div>${statusHtml}</div>
            <div>
              ${
                cls.phone
                  ? `<span class="muted" style="margin-right:8px;">üìû ${cls.phone}</span>`
                  : ""
              }
              ${actionHtml || ""}
            </div>
          </div>
        </div>`;
      });
      container.innerHTML = html;

      container.querySelectorAll("[data-action='apply']").forEach((btn) => {
        btn.addEventListener("click", () => {
          if (!currentUser || currentUser.role !== "tutor" || !currentUser.approved) return;
          const id = Number(btn.dataset.id);
          const cls = classes.find((c) => c.id === id);
          if (!cls) return;
          if (!getApplicationForTutor(cls, currentUser.username)) {
            cls.applicants.push({ username: currentUser.username, status: "pending" });
            alert("ƒê√£ g·ª≠i ƒëƒÉng k√≠ nh·∫≠n l·ªõp. Vui l√≤ng ch·ªù ph·ª• huynh x√°c nh·∫≠n.");
            renderClassesForTutor();
            renderParentPosts();
          }
        });
      });

      const payBtns = container.querySelectorAll("[data-action='pay']");
      payBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = Number(btn.dataset.id);
          openPaymentModal(id);
        });
      });

      const quizBtn = document.getElementById("open-quiz-from-status");
      if (quizBtn) {
        quizBtn.addEventListener("click", () => {
          if (currentUser && currentUser.role === "tutor") {
            currentQuizUser = currentUser.username;
            openQuizForUser();
          }
        });
      }
    }

    function renderTutorProfile() {
      const guard = $("#tutor-not-logged");
      const wrap = $("#tutor-profile-wrapper");
      if (!currentUser || currentUser.role !== "tutor") {
        guard.classList.remove("hidden");
        wrap.classList.add("hidden");
        return;
      }
      guard.classList.add("hidden");
      wrap.classList.remove("hidden");

      const u = currentUser;
      const profileCard = $("#tutor-profile-card");

      // rating
      let ratingText = "Ch∆∞a c√≥ ƒë√°nh gi√°";
      if (u.ratingCount && u.ratingValue) {
        ratingText = `${u.ratingValue.toFixed(1)}/5 (${u.ratingCount} ƒë√°nh gi√°)`;
      }

      const achievementsHtml =
        u.achievements && u.achievements.length
          ? `<ul>${u.achievements.map((a) => `<li>${a}</li>`).join("")}</ul>`
          : `<p class="muted small">Ch∆∞a c√≥ th√†nh t√≠ch n√†o. B·∫°n c√≥ th·ªÉ th√™m b√™n d∆∞·ªõi.</p>`;

      profileCard.innerHTML = `
        <div class="profile-header">
          <div class="profile-avatar">${u.name.split(" ").slice(-1)[0][0] || "G"}</div>
          <div>
            <h3>${u.name}</h3>
            <p>Gia s∆∞ m√¥n ${u.subject || "____"}</p>
            <div class="rating-stars">‚òÖ ‚òÖ ‚òÖ ‚òÖ ‚òÖ</div>
            <div class="muted small">ƒê√°nh gi√° hi·ªán t·∫°i: ${ratingText}</div>
          </div>
        </div>
        <div class="profile-grid">
          <div><strong>Gi·ªõi t√≠nh:</strong> <span>${u.gender || "-"}</span></div>
          <div><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> <span>${u.phone || "-"}</span></div>
          <div><strong>Email:</strong> <span>${u.email || "-"}</span></div>
          <div><strong>H·ªçc v·∫•n:</strong> <span>${u.degree || "-"}</span></div>
          <div><strong>Kinh nghi·ªám:</strong> <span>${u.experience || "-"}</span></div>
          <div><strong>Tr·∫°ng th√°i:</strong> <span>${
            u.approved ? "ƒê√£ ƒë∆∞·ª£c ph√©p nh·∫≠n l·ªõp" : "Ch∆∞a v∆∞·ª£t qua b√†i ki·ªÉm tra"
          }</span></div>
        </div>
        <div class="achievements">
          <h4>Th√†nh t√≠ch c√° nh√¢n</h4>
          ${achievementsHtml}
          <textarea id="achievement-input" placeholder="VD: H·ªçc sinh A tƒÉng t·ª´ 6.0 l√™n 8.5 sau 3 th√°ng..."></textarea>
          <button class="btn btn-outline btn-small" id="save-achievement-btn">üí° L∆∞u th√†nh t√≠ch</button>
          <p class="small muted" style="margin-top:4px;">
            Th√†nh t√≠ch do gia s∆∞ cung c·∫•p s·∫Ω ƒë∆∞·ª£c EduMentor ki·ªÉm tra t√≠nh x√°c th·ª±c khi c·∫ßn.
          </p>
        </div>
      `;

      const saveBtn = $("#save-achievement-btn");
      if (saveBtn) {
        saveBtn.addEventListener("click", () => {
          const val = $("#achievement-input").value.trim();
          if (!val) return;
          if (!u.achievements) u.achievements = [];
          u.achievements.push(val);
          $("#achievement-input").value = "";
          renderTutorProfile();
        });
      }

      // classes of tutor
      const list = $("#tutor-classes-list");
      let html = "";
      classes.forEach((cls) => {
        const app = getApplicationForTutor(cls, u.username);
        if (!app) return;
        let statusHtml = "";
        if (app.status === "pending")
          statusHtml = '<span class="status-pill status-pending">ƒêang ch·ªù ph·ª• huynh ch·∫•p nh·∫≠n</span>';
        else if (app.status === "accepted")
          statusHtml =
            '<span class="status-pill status-accepted">ƒê√£ ƒë∆∞·ª£c ch·∫•p nh·∫≠n ‚Äì ch·ªù thanh to√°n ph√≠ nh·∫≠n l·ªõp</span>';
        else if (app.status === "paid")
          statusHtml =
            '<span class="status-pill status-connected">K·∫øt n·ªëi l·ªõp th√†nh c√¥ng</span>';
        else if (app.status === "rejected")
          statusHtml =
            '<span class="status-pill status-rejected">R·∫•t ti·∫øc, ph·ª• huynh ƒë√£ ch·ªçn gia s∆∞ kh√°c</span>';

        html += `
        <div class="class-card">
          <div class="class-top-row">
            <div>
              <div class="class-title">${cls.parentName}</div>
              <div class="muted">M√¥n ${cls.subject} ‚Äì ${cls.gradeText}</div>
            </div>
            <div class="badge-subject">${cls.subject}</div>
          </div>
          <div class="class-meta">
            <span>ƒê·ªãa ch·ªâ: ${cls.address}</span>
            <span>Th·ªùi gian: ${cls.schedule}</span>
            <span>M·ª©c l∆∞∆°ng: ${cls.fee}</span>
          </div>
          <div class="class-footer">
            <div>${statusHtml}</div>
          </div>
        </div>`;
      });
      list.innerHTML = html || '<p class="muted small">Ch∆∞a ƒëƒÉng k√≠ l·ªõp n√†o.</p>';
    }

    function renderParentPosts() {
      const guard = $("#parent-not-logged");
      const wrap = $("#parent-posts-wrapper");
      const list = $("#parent-posts-list");
      if (!currentUser || currentUser.role !== "parent") {
        guard.classList.remove("hidden");
        wrap.classList.add("hidden");
        return;
      }
      guard.classList.add("hidden");
      wrap.classList.remove("hidden");

      let html = "";
      classes.forEach((cls) => {
        if (cls.parentUsername !== currentUser.username) return;
        const applicantCount = cls.applicants.length;
        let applicantsText = applicantCount
          ? `Xem gia s∆∞ ·ª©ng tuy·ªÉn (${applicantCount})`
          : "Ch∆∞a c√≥ gia s∆∞ ·ª©ng tuy·ªÉn";

        let statusHtml = "";
        if (!cls.acceptedTutor && !applicantCount) {
          statusHtml = '<span class="status-pill">Ch∆∞a c√≥ gia s∆∞ ·ª©ng tuy·ªÉn</span>';
        } else if (!cls.acceptedTutor && applicantCount) {
          statusHtml =
            '<span class="status-pill status-pending">ƒêang ch·ªù ph·ª• huynh xem danh s√°ch gia s∆∞ ·ª©ng tuy·ªÉn</span>';
        } else if (cls.acceptedTutor) {
          const tutorName = users[cls.acceptedTutor]
            ? users[cls.acceptedTutor].name
            : cls.acceptedTutor;
          const app = getApplicationForTutor(cls, cls.acceptedTutor);
          if (app && app.status === "paid") {
            statusHtml = `<span class="status-pill status-connected">ƒê√£ k·∫øt n·ªëi v·ªõi gia s∆∞ ${tutorName}</span>`;
          } else if (app && app.status === "accepted") {
            statusHtml = `<span class="status-pill status-accepted">ƒê√£ ch·ªçn gia s∆∞ ${tutorName}. Ch·ªù thanh to√°n ph√≠.</span>`;
          }
        }

        // rating form
        let ratingHtml = "";
        const acceptedApp =
          cls.acceptedTutor && getApplicationForTutor(cls, cls.acceptedTutor);
        if (acceptedApp && acceptedApp.status === "paid") {
          if (!cls.rating) {
            ratingHtml = `
              <div class="small" style="margin-top:6px;">
                <strong>ƒê√°nh gi√° gia s∆∞:</strong>
                <select data-rate-select="${cls.id}">
                  <option value="">S·ªë sao</option>
                  <option value="5">5 sao</option>
                  <option value="4">4 sao</option>
                  <option value="3">3 sao</option>
                  <option value="2">2 sao</option>
                  <option value="1">1 sao</option>
                </select>
                <textarea data-rate-comment="${cls.id}" style="width:100%;margin-top:4px;border-radius:10px;border:1px solid var(--border);padding:6px 8px;font-size:12px;" placeholder="Nh·∫≠n x√©t ng·∫Øn v·ªÅ gia s∆∞..."></textarea>
                <button class="btn btn-small btn-outline" data-rate-submit="${cls.id}" style="margin-top:4px;">üí¨ G·ª≠i ƒë√°nh gi√°</button>
              </div>
            `;
          } else {
            ratingHtml = `
              <div class="small" style="margin-top:6px;">
                <strong>ƒê√°nh gi√° c·ªßa b·∫°n:</strong>
                <span class="rating-stars">${"‚òÖ".repeat(
                  cls.rating.value
                )}${"‚òÜ".repeat(5 - cls.rating.value)}</span>
                ‚Äì ${cls.rating.comment || "Kh√¥ng c√≥ nh·∫≠n x√©t"}
              </div>
            `;
          }
        }

        html += `
        <div class="class-card">
          <div class="class-top-row">
            <div>
              <div class="class-title">${cls.parentName}</div>
              <div class="muted">C·∫ßn gia s∆∞ m√¥n ${cls.subject} ‚Äì ${cls.gradeText}</div>
            </div>
            <div class="badge-subject">${cls.subject}</div>
          </div>
          <div class="class-meta">
            <span>ƒê·ªãa ch·ªâ h·ªçc: ${cls.address}</span>
            <span>Th·ªùi gian h·ªçc: ${cls.schedule}</span>
            <span>M·ª©c l∆∞∆°ng: ${cls.fee}</span>
            <span>Y√™u c·∫ßu b·∫±ng c·∫•p: ${cls.degreeReq}</span>
            <span>Y√™u c·∫ßu gi·ªõi t√≠nh/kinh nghi·ªám: ${cls.genderReq}</span>
            <span>M·ª•c ti√™u h·ªçc t·∫≠p: ${cls.goal}</span>
          </div>
          <div class="class-footer">
            <div>${statusHtml}</div>
            <div>
              <span class="muted" style="margin-right:8px;">üìû ${cls.phone}</span>
              ${
                applicantCount
                  ? `<button class="btn btn-outline btn-small" data-action="view-applicants" data-id="${cls.id}">${applicantsText}</button>`
                  : `<span class="muted small">${applicantsText}</span>`
              }
            </div>
          </div>
          ${ratingHtml}
        </div>`;
      });
      list.innerHTML = html || '<p class="muted small">B·∫°n ch∆∞a c√≥ b√†i ƒëƒÉng n√†o.</p>';

      list.querySelectorAll("[data-action='view-applicants']").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = Number(btn.dataset.id);
          openApplicantsModal(id);
        });
      });

      // rating events
      list.querySelectorAll("[data-rate-submit]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = Number(btn.dataset.rateSubmit);
          const select = list.querySelector(`[data-rate-select="${id}"]`);
          const textarea = list.querySelector(`[data-rate-comment="${id}"]`);
          if (!select || !textarea) return;
          const val = Number(select.value);
          const comment = textarea.value.trim();
          if (!val) {
            alert("Vui l√≤ng ch·ªçn s·ªë sao ƒë√°nh gi√°.");
            return;
          }
          const cls = classes.find((c) => c.id === id);
          if (!cls || !cls.acceptedTutor) return;
          cls.rating = { value: val, comment, by: currentUser.username };
          const tutor = users[cls.acceptedTutor];
          if (tutor) {
            if (!tutor.ratingCount) tutor.ratingCount = 0;
            if (!tutor.ratingValue) tutor.ratingValue = 0;
            tutor.ratingValue =
              (tutor.ratingValue * tutor.ratingCount + val) / (tutor.ratingCount + 1);
            tutor.ratingCount += 1;
          }
          alert("C·∫£m ∆°n b·∫°n ƒë√£ ƒë√°nh gi√° gia s∆∞!");
          renderParentPosts();
          renderTutorProfile();
        });
      });
    }

    function updateCreatePostGuard() {
      const guard = $("#create-post-guard");
      const wrapper = $("#create-post-form-wrapper");
      if (!currentUser || currentUser.role !== "parent") {
        guard.classList.remove("hidden");
        wrapper.classList.add("hidden");
      } else {
        guard.classList.add("hidden");
        wrapper.classList.remove("hidden");
      }
    }

    // ===== APPLICANTS MODAL =====
    function openApplicantsModal(classId) {
      currentApplicantsClassId = classId;
      const cls = classes.find((c) => c.id === classId);
      if (!cls) return;
      const list = $("#applicants-list");
      if (!cls.applicants.length) {
        list.innerHTML = '<p class="muted small">Hi·ªán ch∆∞a c√≥ gia s∆∞ ·ª©ng tuy·ªÉn.</p>';
      } else {
        let html = "";
        cls.applicants.forEach((app) => {
          const tutor = users[app.username];
          const name = tutor ? tutor.name : app.username;
          const initial = name.split(" ").slice(-1)[0][0] || "G";
          let statusText = "";
          if (app.status === "pending") statusText = "ƒêang ch·ªù quy·∫øt ƒë·ªãnh";
          else if (app.status === "accepted") statusText = "ƒê√£ ƒë∆∞·ª£c ch·ªçn";
          else if (app.status === "rejected") statusText = "ƒê√£ b·ªã t·ª´ ch·ªëi";
          else if (app.status === "paid") statusText = "ƒê√£ thanh to√°n ‚Äì k·∫øt n·ªëi th√†nh c√¥ng";

          html += `
          <div class="applicant-row">
            <div class="applicant-main">
              <div class="avatar-circle">${initial}</div>
              <div>
                <div>${name}</div>
                <div class="muted small">${tutor ? tutor.subject || "Gia s∆∞" : "Gia s∆∞"}</div>
                <div class="small muted">${statusText}</div>
              </div>
            </div>
            <div>
              <button class="btn btn-small btn-outline" data-accept="${app.username}">Ch·∫•p nh·∫≠n</button>
              <button class="btn btn-small" style="background:#ffe6e6;color:#b3261e;" data-reject="${app.username}">T·ª´ ch·ªëi</button>
            </div>
          </div>`;
        });
        list.innerHTML = html;
      }

      // attach events
      list.querySelectorAll("[data-accept]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const username = btn.dataset.accept;
          const cls = classes.find((c) => c.id === currentApplicantsClassId);
          if (!cls) return;
          cls.acceptedTutor = username;
          cls.applicants.forEach((a) => {
            if (a.username === username) a.status = "accepted";
            else a.status = "rejected";
          });
          alert("ƒê√£ ch·∫•p nh·∫≠n gia s∆∞. Vui l√≤ng th√¥ng b√°o cho gia s∆∞ thanh to√°n ph√≠ nh·∫≠n l·ªõp.");
          renderParentPosts();
          renderClassesForTutor();
          renderTutorProfile();
          openApplicantsModal(cls.id); // refresh
        });
      });

      list.querySelectorAll("[data-reject]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const username = btn.dataset.reject;
          const cls = classes.find((c) => c.id === currentApplicantsClassId);
          if (!cls) return;
          const app = cls.applicants.find((a) => a.username === username);
          if (app) app.status = "rejected";
          if (cls.acceptedTutor === username) cls.acceptedTutor = null;
          alert("ƒê√£ t·ª´ ch·ªëi gia s∆∞.");
          renderParentPosts();
          renderClassesForTutor();
          renderTutorProfile();
          openApplicantsModal(cls.id);
        });
      });

      openModal("applicants-modal");
    }

    // ===== PAYMENT =====
    function openPaymentModal(classId) {
      currentPaymentClassId = classId;
      const cls = classes.find((c) => c.id === classId);
      if (!cls || !currentUser) return;
      const tutorApp = getApplicationForTutor(cls, currentUser.username);
      if (!tutorApp || tutorApp.status !== "accepted") return;
      $("#payment-class-text").textContent =
        "L·ªõp: " +
        cls.parentName +
        " ‚Äì M√¥n " +
        cls.subject +
        " ‚Äì " +
        cls.gradeText +
        ". Ph√≠ nh·∫≠n l·ªõp: 25% th√°ng ƒë·∫ßu (" +
        cls.fee +
        ").";
      openModal("payment-modal");
    }

    $("#confirm-payment-btn").addEventListener("click", () => {
      if (!currentUser || currentUser.role !== "tutor" || !currentPaymentClassId) return;
      const cls = classes.find((c) => c.id === currentPaymentClassId);
      if (!cls) return;
      const app = getApplicationForTutor(cls, currentUser.username);
      if (!app || app.status !== "accepted") return;
      app.status = "paid";
      alert("Thanh to√°n th√†nh c√¥ng! K·∫øt n·ªëi l·ªõp ƒë√£ ƒë∆∞·ª£c x√°c nh·∫≠n.");
      renderClassesForTutor();
      renderTutorProfile();
      renderParentPosts();
      closeModal("payment-modal");
    });

    // ===== QUIZ =====
    const quizQuestions = [
      {
        q: "Trong 5 bu·ªïi, h·ªçc sinh l√†m ƒë√∫ng 40/50 c√¢u. ƒêi·ªÉm ph·∫ßn trƒÉm ch√≠nh x√°c l√†:",
        opts: ["70%", "75%", "80%", "90%"],
        ans: 2
      },
      {
        q: "Ph∆∞∆°ng tr√¨nh 2x + 5 = 15 c√≥ nghi·ªám:",
        opts: ["x = 5", "x = 10", "x = -5", "x = 2,5"],
        ans: 0
      },
      {
        q: "Khi h·ªçc sinh kh√¥ng hi·ªÉu b√†i, ph·∫£n ·ª©ng ph√π h·ª£p nh·∫•t c·ªßa gia s∆∞ l√†:",
        opts: [
          "Gi·∫£ng l·∫°i v·ªõi v√≠ d·ª• ƒë∆°n gi·∫£n h∆°n",
          "TƒÉng t·ªëc ƒë·ªô gi·∫£ng ƒë·ªÉ k·ªãp th·ªùi gian",
          "B·ªè qua, nh·∫Øc h·ªçc sinh t·ª± xem l·∫°i",
          "Ph√™ b√¨nh tr∆∞·ªõc m·∫∑t ph·ª• huynh"
        ],
        ans: 0
      },
      {
        q: "M·ªôt bu·ªïi d·∫°y hi·ªáu qu·∫£ n√™n:",
        opts: [
          "Ch·ªâ l√†m b√†i t·∫≠p trong s√°ch",
          "Bao g·ªìm √¥n l·∫°i, gi·∫£ng b√†i m·ªõi v√† luy·ªán t·∫≠p",
          "Ch·ªâ t·∫≠p trung v√†o b√†i kh√≥",
          "Cho h·ªçc sinh t·ª± h·ªçc, gia s∆∞ ch·ªâ quan s√°t"
        ],
        ans: 1
      },
      {
        q: "Y·∫øu t·ªë quan tr·ªçng nh·∫•t c·ªßa gia s∆∞ EduMentor l√†:",
        opts: ["Ki·∫øn th·ª©c", "S·ª± t·∫≠n t√¢m", "L∆∞∆°ng cao", "Th·ªùi gian r·∫£nh"],
        ans: 1
      }
    ];

    function renderQuiz() {
      const list = $("#quiz-list");
      let html = "";
      quizQuestions.forEach((q, idx) => {
        html += `
          <div class="quiz-question">
            <strong>C√¢u ${idx + 1}: ${q.q}</strong>
            <div class="quiz-options">
              ${q.opts
                .map(
                  (opt, i) =>
                    `<label><input type="radio" name="quiz-${idx}" value="${i}"> ${opt}</label>`
                )
                .join("")}
            </div>
          </div>
        `;
      });
      list.innerHTML = html;
      $("#quiz-result").textContent = "";
    }

    function openQuizForUser() {
      renderQuiz();
      openModal("quiz-modal");
    }

    $("#quiz-submit-btn").addEventListener("click", () => {
      let score = 0;
      quizQuestions.forEach((q, idx) => {
        const selected = document.querySelector(
          `input[name="quiz-${idx}"]:checked`
        );
        if (selected && Number(selected.value) === q.ans) score += 2;
      });
      const resultEl = $("#quiz-result");
      if (score >= 8) {
        resultEl.innerHTML =
          '<span style="color:var(--success);font-weight:600;">B·∫°n ƒë·∫°t ' +
          score +
          "/10. T√†i kho·∫£n gia s∆∞ ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t!</span>";
        if (currentQuizUser && users[currentQuizUser]) {
          users[currentQuizUser].approved = true;
        }
        if (currentQuizUser && (!currentUser || currentUser.username === currentQuizUser)) {
          currentUser = users[currentQuizUser];
          updateAuthUI();
        }
      } else {
        resultEl.innerHTML =
          '<span style="color:var(--danger);font-weight:600;">B·∫°n ƒë·∫°t ' +
          score +
          "/10. Ch∆∞a ƒë·∫°t y√™u c·∫ßu, vui l√≤ng th·ª≠ l·∫°i sau.</span>";
      }
    });

    // ===== AUTH HANDLERS =====
    $("#open-login").addEventListener("click", () => openModal("login-modal"));
    $("#open-register").addEventListener("click", () =>
      openModal("register-modal")
    );

    $("#login-open-register").addEventListener("click", () => {
      closeModal("login-modal");
      openModal("register-modal");
    });
    $("#register-open-login").addEventListener("click", () => {
      closeModal("register-modal");
      openModal("login-modal");
    });

    $$("#login-modal .modal-close").forEach((btn) =>
      btn.addEventListener("click", () => closeModal("login-modal"))
    );
    $$("#register-modal .modal-close").forEach((btn) =>
      btn.addEventListener("click", () => closeModal("register-modal"))
    );
    $$("#quiz-modal .modal-close").forEach((btn) =>
      btn.addEventListener("click", () => closeModal("quiz-modal"))
    );
    $$("#payment-modal .modal-close").forEach((btn) =>
      btn.addEventListener("click", () => closeModal("payment-modal"))
    );
    $$("#applicants-modal .modal-close").forEach((btn) =>
      btn.addEventListener("click", () => closeModal("applicants-modal"))
    );

    $$(".modal-backdrop").forEach((backdrop) => {
      backdrop.addEventListener("click", (e) => {
        if (e.target === backdrop) backdrop.classList.remove("show");
      });
    });

    // login tabs
    const loginTabs = $$("#login-modal .modal-tab");
    const loginParentForm = $("#login-parent-form");
    const loginTutorForm = $("#login-tutor-form");
    loginTabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        loginTabs.forEach((t) => t.classList.remove("active"));
        tab.classList.add("active");
        const type = tab.dataset.loginTarget;
        if (type === "parent") {
          loginParentForm.classList.remove("hidden");
          loginTutorForm.classList.add("hidden");
        } else {
          loginParentForm.classList.add("hidden");
          loginTutorForm.classList.remove("hidden");
        }
      });
    });

    loginParentForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const u = $("#login-parent-username").value.trim();
      const p = $("#login-parent-password").value;
      const acc = users[u];
      if (!acc || acc.password !== p || acc.role !== "parent") {
        alert("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u ph·ª• huynh.");
        return;
      }
      currentUser = acc;
      closeModal("login-modal");
      updateAuthUI();
      showSection("parent-posts-section");
    });

    loginTutorForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const u = $("#login-tutor-username").value.trim();
      const p = $("#login-tutor-password").value;
      const acc = users[u];
      if (!acc || acc.password !== p || acc.role !== "tutor") {
        alert("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u gia s∆∞.");
        return;
      }
      currentUser = acc;
      updateAuthUI();
      closeModal("login-modal");
      showSection("classes-section");
    });

    $("#logout-btn").addEventListener("click", () => {
      currentUser = null;
      updateAuthUI();
      showSection("home-section");
    });

    // register
    $("#register-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const ln = $("#reg-lastname").value.trim();
      const fn = $("#reg-firstname").value.trim();
      const email = $("#reg-email").value.trim();
      const phone = $("#reg-phone").value.trim();
      const username = $("#reg-username").value.trim();
      const password = $("#reg-password").value;
      const role = $("#reg-role").value;
      if (!ln || !fn || !email || !phone || !username || !password) {
        alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc.");
        return;
      }
      if (users[username]) {
        alert("T√™n t√†i kho·∫£n ƒë√£ t·ªìn t·∫°i, vui l√≤ng ch·ªçn t√™n kh√°c.");
        return;
      }
      const user = {
        username,
        password,
        role,
        name: ln + " " + fn,
        email,
        phone,
        gender: "",
        subject: role === "tutor" ? "To√°n" : "",
        achievements: [],
        approved: role === "tutor" ? false : true
      };
      users[username] = user;
      if (role === "tutor") {
        alert(
          "ƒêƒÉng k√Ω t√†i kho·∫£n gia s∆∞ th√†nh c√¥ng. Vui l√≤ng l√†m b√†i ki·ªÉm tra ƒë·ªÉ ƒë∆∞·ª£c k√≠ch ho·∫°t."
        );
        currentQuizUser = username;
        closeModal("register-modal");
        openQuizForUser();
      } else {
        alert("ƒêƒÉng k√Ω t√†i kho·∫£n ph·ª• huynh th√†nh c√¥ng. B·∫°n c√≥ th·ªÉ ƒëƒÉng nh·∫≠p ngay.");
        closeModal("register-modal");
        currentUser = user;
        updateAuthUI();
        showSection("create-post-section");
      }
    });

    // ===== NAV =====
    $$(".nav-link").forEach((btn) => {
      btn.addEventListener("click", () => {
        const id = btn.dataset.section;
        showSection(id);
      });
    });

    // hero buttons
    $("#cta-find-class").addEventListener("click", () => {
      if (!currentUser || currentUser.role !== "tutor") {
        openModal("login-modal");
        // chuy·ªÉn tab gia s∆∞
        loginTabs.forEach((t) => {
          const isTutor = t.dataset.loginTarget === "tutor";
          t.classList.toggle("active", isTutor);
        });
        loginParentForm.classList.add("hidden");
        loginTutorForm.classList.remove("hidden");
      } else {
        showSection("classes-section");
      }
    });

    $("#cta-become-tutor").addEventListener("click", () => {
      if (currentUser && currentUser.role === "tutor") {
        showSection("tutor-section");
      } else {
        openModal("register-modal");
        $("#reg-role").value = "tutor";
      }
    });

    // create post
    $("#submit-post-btn").addEventListener("click", () => {
      if (!currentUser || currentUser.role !== "parent") {
        alert("Vui l√≤ng ƒëƒÉng nh·∫≠p v·ªõi vai tr√≤ ph·ª• huynh ƒë·ªÉ ƒëƒÉng b√†i.");
        return;
      }
      const subject = $("#post-subject").value;
      const grade = $("#post-grade").value.trim();
      const address = $("#post-address").value.trim();
      const schedule = $("#post-schedule").value.trim();
      const fee = $("#post-fee").value.trim();
      const degree = $("#post-degree").value.trim() || "Kh√¥ng y√™u c·∫ßu";
      const gender = $("#post-gender").value.trim() || "Kh√¥ng y√™u c·∫ßu";
      const goal = $("#post-goal").value.trim() || "Chung chung";
      const phone = $("#post-phone").value.trim();
      if (!grade || !address || !schedule || !fee || !phone) {
        alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc.");
        return;
      }
      const newId = classes.length ? classes[classes.length - 1].id + 1 : 1;
      classes.push({
        id: newId,
        parentUsername: currentUser.username,
        parentName: currentUser.name,
        subject,
        gradeText: grade,
        address,
        schedule,
        fee,
        degreeReq: degree,
        genderReq: gender,
        goal,
        phone,
        applicants: [],
        acceptedTutor: null,
        rating: null
      });
      alert("ƒêƒÉng b√†i t√¨m gia s∆∞ th√†nh c√¥ng (demo).");
      renderParentPosts();
      renderClassesForTutor();
    });

    // INIT
    updateAuthUI();
    renderClassesForTutor();
    renderParentPosts();
    showSection("home-section");
  </script>
</body>
</html>
